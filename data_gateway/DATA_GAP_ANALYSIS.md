# 数据网关 vs SAPAS 需求分析

## 📊 功能对比分析

### 1. SAPAS 现有功能需求

根据 FEATURE_MERGE_ANALYSIS.md 和现有代码，SAPAS 需要：

| 模块 | 数据需求 | 当前状态 |
|------|---------|---------|
| **基础行情** | 日K线、分时、实时报价 | ✅ 已实现 |
| **技术指标** | 32个技术指标数据 | ✅ 已实现 |
| **资金流向** | 个股资金流向分析 | ✅ 已实现 |
| **集合竞价** | 集合竞价数据 | ✅ 已实现 |
| **基本面** | 财务数据、估值指标 | ✅ 已实现 |
| **自选股** | 自选股管理 | ✅ 已实现 |
| **回测系统** | 历史数据回测 | ✅ 已实现 |
| **WebSocket** | 实时推送 | ✅ 已实现 |
| **告警系统** | 价格/指标告警 | ✅ 已实现 |

### 2. InStock 推荐的高优先级功能

| 功能 | 数据需求 | 数据网关支持 | AKShare支持 |
|------|---------|------------|-----------|
| **K线形态识别** | 日K线OHLCV | ✅ | ✅ |
| **龙虎榜数据** | 每日龙虎榜、营业部席位 | ❌ | ✅ |
| **筹码分布分析** | 历史成交量和价格 | ✅ | 需计算 |
| **资金流向(细化)** | 大单分类数据 | ❌ | ✅ |
| **跌停分析** | 跌停股票数据 | ❌ | ✅ |
| **ETF数据** | ETF行情、净值 | ❌ | ✅ |
| **综合选股** | 200+维度数据 | ❌ | ✅ |

### 3. 数据网关当前提供的数据

#### ✅ 已支持

| 数据类型 | 市场覆盖 | 数据源 | API |
|---------|---------|-------|-----|
| **实时报价** | A股、港股、美股、期货 | AKShare | `/api/v1/quote` |
| **K线数据** | A股、港股、美股、期货、经济 | AKShare + BaoStock | `/api/v1/kline` |
| **基本面数据** | A股 | BaoStock | `/api/v1/fundamentals` |
| **多周期K线** | 日、周、月 | AKShare + BaoStock | period参数 |

#### ❌ 未支持

| 数据类型 | 优先级 | AKShare可用 | 备注 |
|---------|-------|-----------|------|
| **龙虎榜** | 🔴 高 | ✅ | 需新增 |
| **资金流向(细化)** | 🟡 中 | ✅ | 需新增 |
| **大单分析** | 🟢 低 | ✅ | 需新增 |
| **分时数据** | 🟡 中 | ✅ | 需新增 |
| **板块数据** | 🟡 中 | ✅ | 需新增 |
| **ETF数据** | 🟢 低 | ✅ | 需新增 |
| **跌停分析** | 🟡 中 | ✅ | 需新增 |
| **涨跌停** | 🟢 低 | ✅ | 需新增 |
| **新股数据** | 🟢 低 | ✅ | 需新增 |

## 🎯 功能差距分析

### 数据网关能满足的需求

#### ✅ 基础数据需求（100%满足）
- 实时行情数据
- 日K线历史数据
- 多周期K线（日/周/月）
- 多市场支持（A股/港股/美股）
- 基本面数据

#### ✅ 高级分析需求的基础数据
- K线形态识别需要：日K线OHLCV数据
- 筹码分析需要：历史成交量和价格数据
- 技术指标计算需要：OHLCV数据

### 数据网关不能满足的需求

#### ❌ 需要新增的数据接口

1. **龙虎榜数据**（高优先级）
   ```
   AKShare函数: ak.stock_em_djyg_detail()
   需要添加: dragon_tiger 数据源和市场网关
   ```

2. **资金流向（细化）**（中优先级）
   ```
   AKShare函数:
   - ak.stock_individual_fund_flow_em()
   - ak.stock_individual_fund_flow_rank()
   需要添加: 资金流向专用接口
   ```

3. **大单分析**（低优先级）
   ```
   AKShare函数: ak.stock_block_trade()
   需要添加: 大单数据接口
   ```

4. **分时数据**（中优先级）
   ```
   AKShare函数: ak.stock_zh_a_hist_min_em()
   需要添加: 分钟K线接口
   ```

5. **板块数据**（中优先级）
   ```
   AKShare函数:
   - ak.stock_board_industry_name_em()
   - ak.stock_board_concept_name_em()
   需要添加: 板块数据接口
   ```

## 💡 建议实施方案

### 短期（1周内）

1. **添加分钟K线接口**
   - 扩展现有 K线接口支持分钟级
   - 添加 period: 1m, 5m, 15m, 30m, 60m

2. **添加龙虎榜数据接口**
   ```python
   # 新增数据源
   class DragonTigerSource(DataSource):
       async def get_daily_list(date: str) -> List[DragonTigerItem]
   ```

### 中期（2-3周）

3. **添加资金流向细分接口**
4. **添加板块数据接口**
5. **添加涨跌停数据接口**

### 长期（1个月+）

6. **添加ETF数据接口**
7. **添加大单分析接口**
8. **优化数据缓存策略**

## 📋 数据网关扩展计划

### 建议新增的API接口

```python
# 1. 龙虎榜数据
GET /api/v1/dragon-tiger/daily?date=2026-01-25
GET /api/v1/dragon-tiger/stock/{code}?days=30

# 2. 资金流向（细分）
GET /api/v1/money-flow/{code}?date=2026-01-25
GET /api/v1/money-flow/large-orders?market=cn_a

# 3. 分时数据
GET /api/v1/kline/{code}?period=1m&date=2026-01-25

# 4. 板块数据
GET /api/v1/sectors/industry
GET /api/v1/sectors/concept
GET /api/v1/sectors/flow

# 5. 涨跌停
GET /api/v1/limit-up?date=2026-01-25
GET /api/v1/limit-down?date=2026-01-25

# 6. ETF数据
GET /api/v1/etf/list
GET /api/v1/etf/{code}
```

## 🎯 总结

### 数据网关的优势
1. ✅ **架构清晰**: 统一的数据接口，易于扩展
2. ✅ **多源支持**: AKShare + BaoStock，可添加更多
3. ✅ **多市场**: A股/港股/美股/期货/经济
4. ✅ **缓存机制**: PostgreSQL缓存，减少外部调用
5. ✅ **同步功能**: 支持批量历史数据同步
6. ✅ **独立部署**: 可单独部署和扩展

### 当前满足度

| SAPAS功能需求 | 满足度 | 说明 |
|--------------|-------|------|
| 基础行情数据 | ✅ 100% | 完全满足 |
| 技术指标计算 | ✅ 100% | 数据充足 |
| 回测系统 | ✅ 100% | 历史数据充足 |
| 资金流向 | ⚠️ 50% | 有基础，缺细化 |
| K线形态识别 | ✅ 100% | 数据充足 |
| 筹码分析 | ✅ 100% | 数据充足 |
| 龙虎榜 | ❌ 0% | 需新增 |
| 跌停分析 | ❌ 0% | 需新增 |
| ETF数据 | ❌ 0% | 需新增 |

### 建议行动

**立即行动**（本周完成）:
1. 添加分钟K线支持（1天）
2. 添加龙虎榜数据接口（2-3天）

**近期行动**（2周内）:
3. 添加资金流向细分接口
4. 添加板块数据接口

**中期行动**（1个月内）:
5. 添加涨跌停数据
6. 添加ETF数据
7. 优化缓存和同步策略

数据网关的架构已经很好，只需要按需扩展数据源即可满足SAPAS的所有功能需求。
